<?xml version="1.0"?>
<project name="drftpd" basedir="." default="compile">

    <target name="all" depends="compile"/>

    <target name="init">
        <property name="build.compiler" value="gcj"/>
        <!-- You might like to set up some overridable paths, etc.: -->
        <!-- <property name="mylib" value="../lib/mylib.jar"/> -->
        <property name="sourceDir" value="src/"/>
        <property name="outputDir" value="classes/"/>

	<path id="classpath">
	    <pathelement path="/usr/share/jdom/lib/jdom.jar"/>
	    <pathelement path="/usr/share/log4j/lib/log4j-1.2.7.jar"/>
	    <pathelement path="/usr/share/oro/lib/oro.jar"/>
		<pathelement path="martyr-0.3.0/martyr.jar" />
		<pathelement path="JSX1.0.7.4.jar" />
	    <fileset dir=".">
	        <include name="lib/*"/>
	    </fileset>
	</path>
    </target>


    <target name="clean" depends="init">
        <delete dir="${outputDir}" />
    </target>

   <target name="prepare" depends="init">
      <mkdir dir="${outputDir}" />
   </target>

   <target name="compile" depends="init, prepare">
    <javac destdir="${outputDir}" debug="yes">
	<src path="${sourceDir}"/>
	<classpath refid="classpath"/>
    </javac>
    <rmic base="${outputDir}" sourcebase="${sourceDir}" stubversion="1.2">
	<include name="**/*Impl.class"/>
	<classpath refid="classpath"/>
    </rmic>
  </target>
  
  <target name="slavejar" depends="compile">
    <jar destfile="slave.jar" basedir="classes">
      <manifest>
        <attribute name="Main-Class" value="net.sf.drftpd.slave.SlaveImpl" />
      </manifest>
      <include name="se/mog/io/**/*.class" />
      <include name="net/sf/drftpd/*" />
      <include name="net/sf/drftpd/slave/*" />
      <include name="net/sf/drftpd/remotefile/RemoteFile.class" />
      <include name="net/sf/drftpd/remotefile/LinkedRemoteFile.class" />
      <include name="net/sf/drftpd/remotefile/FileRemoteFile.class" />
      <include name="net/sf/drftpd/remotefile/DirectoryRemoteFile.class" />
      <include name="net/sf/drftpd/remotefile/StaticRemoteFile.class" />
      <include name="net/sf/drftpd/master/RemoteSlave.class" />
      <include name="net/sf/drftpd/master/SlaveManager.class" />
      <include name="net/sf/drftpd/master/SlaveManagerImpl_Stub.class" />
      <!-- until we have lightweight LinkedRemoteFile -->
      <include name="net/sf/drftpd/master/*" />
    </jar>
    
    <zip destfile="slave.zip" basedir=".">
      <include name="slave.jar"/>
      <include name="drftpd.conf.dist"/>
      <include name="slave.sh" />
      <include name="slave.bat" />
      <zipfileset dir="." includes="src/se/mog/io/libFileSystem.so" fullpath="libFileSystem.so" />
      <zipfileset dir="." includes="src/se/mog/io/FileSystem.dll" fullpath="FileSystem.dll" />
    </zip>
  </target>
</project>
