<?xml version="1.0"?>
<project name="drftpd" basedir="." default="compile">

    <target name="all" depends="compile"/>

    <target name="init">
<!--        <property name="build.compiler" value="gcj"/>-->
        <!-- You might like to set up some overridable paths, etc.: -->
        <!-- <property name="mylib" value="../lib/mylib.jar"/> -->
        <property name="sourceDir" value="src/"/>
        <property name="outputDir" value="classes/"/>

	<path id="classpath">
	    <fileset dir=".">
	        <include name="lib/*"/>
	    </fileset>
	</path>
    </target>


    <target name="clean" depends="init">
        <delete dir="${outputDir}" />
    </target>

   <target name="prepare" depends="init">
      <mkdir dir="${outputDir}" />
   </target>

   <target name="compile" depends="init, prepare">
    <javac destdir="${outputDir}" source="1.4">
	<src path="${sourceDir}"/>
	<classpath refid="classpath"/>
    </javac>
    <rmic base="${outputDir}" stubversion="1.2">
	<include name="**/*Impl.class"/>
	<classpath refid="classpath"/>
    </rmic>
  </target>
  
  <target name="slavejar">
    <jar destfile="slave.jar" basedir="classes">
      <manifest>
        <attribute name="Main-Class" value="net.sf.drftpd.slave.SlaveImpl" />
      </manifest>
      <include name="se/mog/io/**/*.class" />
      <include name="net/sf/drftpd/*" />
      <include name="net/sf/drftpd/slave/*" />
      <include name="net/sf/drftpd/remotefile/*" />
      <include name="net/sf/drftpd/master/RemoteSlave.class" />
      <include name="net/sf/drftpd/master/SlaveManager.class" />
      <include name="net/sf/drftpd/master/SlaveManagerImpl_Stub.class" />
      <include name="net/sf/drftpd/permission/InetAddrRMIServerSocketFactory.class" />
      <include name="net/sf/drftpd/permission/InetAddrServerSocket.class" />
      <!-- until we have lightweight LinkedRemoteFile -->
      <include name="net/sf/drftpd/master/*" />
      <include name="net/sf/drftpd/master/config/FtpConfig.class" />
    </jar>
    
    <zip destfile="slave.zip" basedir=".">
      <include name="slave.jar"/>
      <include name="drftpd.conf.dist"/>
      <include name="slave.sh" />
      <include name="slave.bat" />
      <zipfileset dir="." includes="lib/libFileSystem.so" fullpath="libFileSystem.so" />
      <zipfileset dir="." includes="lib/FileSystem.dll" fullpath="FileSystem.dll" />
    </zip>
  </target>
  
  <target name="dist" depends="compile">
    <zip destfile="drftpd-0.7.0.zip" basedir=".">
      <include name="INSTALL.*"/>
      <include name="drftpd.conf.dist"/>
      <include name="slaves.xml.dist"/>
      <include name="slaves.dtd"/>
      <include name="build.xml"/>
      <include name="slave.bat"/>
      <include name="slave.sh"/>
      <include name="master.sh"/>
      <include name="master.bat"/>
      <include name="lib/*"/>
      <include name="src/**"/>
      <include name="classes/**"/>
      <include name="ftp-data/text/**"/>
    </zip>
  </target>
  
</project>
